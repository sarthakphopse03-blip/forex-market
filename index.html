<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Market Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <h1>ðŸ“ˆ Market Dashboard</h1>
</header>

<section class="market">
    <h2>Live Crypto Prices</h2>
    <table>
        <tr>
            <th>Asset</th>
            <th>Price (INR)</th>
        </tr>
        <tr>
            <td>Bitcoin</td>
            <td id="btc">Loading...</td>
        </tr>
        <tr>
            <td>Ethereum</td>
            <td id="eth">Loading...</td>
        </tr>
    </table>
</section>

<section class="chart">
    <h2>BTC Chart</h2>
    <div id="tradingview-widget"></div>
</section>

<script src="script.js"></script>

<!-- TradingView Widget -->
<script src="https://s3.tradingview.com/tv.js"></script>
<script>
new TradingView.widget({
    container_id: "tradingview-widget",
    width: "100%",
    height: 400,
    symbol: "BTCUSDT",
    interval: "D",
    timezone: "Asia/Kolkata",
    theme: "dark",
    style: "1",
    locale: "en"
});
</script>

</body>
</html>
<!DOCTYPE html>
<html>
<head>
    <title>MarketVision</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <h1>ðŸ“Š MarketVision</h1>

    <select id="symbol">
        <option value="AAPL">Apple</option>
        <option value="MSFT">Microsoft</option>
        <option value="GOOGL">Google</option>
    </select>

    <select id="timeframe">
        <option value="1d">1 Day</option>
        <option value="5d">5 Days</option>
        <option value="1mo">1 Month</option>
    </select>
</header>

<div id="chart"></div>

<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
<script src="script.js"></script>
</body>
</html>
body {
    margin: 0;
    background: #0f172a;
    color: white;
    font-family: Arial;
}

header {
    display: flex;
    gap: 15px;
    align-items: center;
    padding: 10px;
    background: #020617;
}

select {
    padding: 6px;
    background: #020617;
    color: white;
    border: 1px solid #334155;
}

#chart {
    height: 520px;
}
const chart = LightweightCharts.createChart(
    document.getElementById("chart"),
    {
        layout: {
            background: { color: "#0f172a" },
            textColor: "#ffffff"
        },
        grid: {
            vertLines: { color: "#1e293b" },
            horzLines: { color: "#1e293b" }
        },
        width: window.innerWidth,
        height: 520
    }
);

const candleSeries = chart.addCandlestickSeries();
const emaSeries = chart.addLineSeries({ color: "yellow", lineWidth: 2 });

// ðŸ”¹ EMA CALCULATION
function calculateEMA(data, period = 10) {
    let k = 2 / (period + 1);
    let ema = data[0].close;
    return data.map(d => {
        ema = d.close * k + ema * (1 - k);
        return { time: d.time, value: ema };
    });
}

// ðŸ”¹ Fetch LIVE stock data (Yahoo Finance proxy)
async function loadData(symbol, range) {
    const url = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?range=${range}&interval=1d`;

    const res = await fetch(url);
    const json = await res.json();

    const result = json.chart.result[0];
    const timestamps = result.timestamp;
    const prices = result.indicators.quote[0];

    const candles = timestamps.map((t, i) => ({
        time: t,
        open: prices.open[i],
        high: prices.high[i],
        low: prices.low[i],
        close: prices.close[i]
    }));

    candleSeries.setData(candles);

    const ema = calculateEMA(candles, 10);
    emaSeries.setData(ema);
}

// Default load
loadData("AAPL", "1mo");

// Symbol change
document.getElementById("symbol").addEventListener("change", () => {
    loadData(
        document.getElementById("symbol").value,
        document.getElementById("timeframe").value
    );
});

// Timeframe change
document.getElementById("timeframe").addEventListener("change", () => {
    loadData(
        document.getElementById("symbol").value,
        document.getElementById("timeframe").value
    );
});
import WebSocket from "ws";

const wss = new WebSocket.Server({ port: 8080 });

const BINANCE_STREAM =
  "wss://stream.binance.com:9443/ws/btcusdt@kline_1m";

const marketSocket = new WebSocket(BINANCE_STREAM);

wss.on("connection", client => {
  marketSocket.on("message", msg => {
    client.send(msg.toString());
  });
});

console.log("WS Server running on :8080");
export function createChart() {
  return LightweightCharts.createChart(
    document.getElementById("chart"),
    {
      layout: {
        background: { color: "#0f172a" },
        textColor: "#e5e7eb"
      },
      grid: {
        vertLines: { color: "#1e293b" },
        horzLines: { color: "#1e293b" }
      }
    }
  );
}
export function EMA(data, period) {
  const k = 2 / (period + 1);
  let ema = data[0].close;

  return data.map(d => {
    ema = d.close * k + ema * (1 - k);
    return { time: d.time, value: ema };
  });
}

export function RSI(data, period = 14) {
  let gains = 0, losses = 0;

  return data.map((d, i) => {
    if (i === 0) return null;

    const diff = d.close - data[i - 1].close;
    diff >= 0 ? (gains += diff) : (losses -= diff);

    const rs = gains / losses;
    return {
      time: d.time,
      value: 100 - 100 / (1 + rs)
    };
  }).filter(Boolean);
}
export const State = {
  candles: [],
  subscribers: [],

  update(data) {
    this.candles.push(data);
    this.subscribers.forEach(fn => fn(this.candles));
  },

  subscribe(fn) {
    this.subscribers.push(fn);
  }
};
import { createChart } from "./chart.js";
import { EMA, RSI } from "./indicators.js";
import { State } from "./state.js";

const chart = createChart();
const candles = chart.addCandlestickSeries();
const emaLine = chart.addLineSeries({ color: "yellow" });
const rsiLine = chart.addLineSeries({ color: "cyan" });

const socket = new WebSocket("ws://localhost:8080");

socket.onmessage = e => {
  const msg = JSON.parse(e.data);
  const k = msg.k;

  const candle = {
    time: k.t / 1000,
    open: +k.o,
    high: +k.h,
    low: +k.l,
    close: +k.c
  };

  State.update(candle);
};

State.subscribe(data => {
  candles.setData(data);
  emaLine.setData(EMA(data, 20));
});
